require(["main"],function(){require(["config"],function(){require(["modules/Pokedex","models/applicationState","domReady"],function(e,t,n){n(function(){e.initialize({model:t})})})})}),define("pokedex",function(){}),define("modules/BaseModule",["require"],function(e){var t={initialize:function(e){e=e||{},this.model=e.model,_.bindAll(this,"_initModule");var t=this.model.get("initialized");t?this._initModule():this.model.on("change:initialized",this._initModule)},_initModule:function(){}};return t}),define("views/PageNavigationView",["require","constants/Elements","underscore","gsapJS","backbone","views/BaseView","constants/Layout","pep"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("gsapJS"),i=e("backbone"),s=e("views/BaseView"),o=e("constants/Layout"),u=e("pep"),a=s.extend({COLLAPSED_CLASS:"collapsed",EXPANDED_CLASS:"expanded",ANIMATE_OPEN_DURATION:.3,ANIMATE_CLOSED_DURATION:.3,ACTIVE_CLASS:"active",tagName:"ul",className:"page-navigation",events:function(){return{"pointerup .toggle div.page-navigation-header":"_onNavigationClick","pointerup .subnav li":"_onSubmenuClick"}},ui:{},initialize:function(e){e=e||{},n.bindAll(this,"_onNavigationClick","_onSubmenuClick","_closeNav","_openNav"),this.setElement(t(this.tagName+"."+this.className)),this.bindUIElements()},_onNavigationClick:function(e){var n=t(e.target).closest("li"),r=this.$el.find("li."+this.EXPANDED_CLASS);n.hasClass(this.EXPANDED_CLASS)?this._closeNav(n):(r&&this._closeNav(r),this._openNav(n))},_onSubmenuClick:function(e){var n=t(e.currentTarget);this.$el.find("li."+this.ACTIVE_CLASS).removeClass(this.ACTIVE_CLASS),n.addClass(this.ACTIVE_CLASS)},_closeNav:function(e){Modernizr.csstransitions?e.removeClass(this.EXPANDED_CLASS).addClass(this.COLLAPSED_CLASS):(e.removeClass(this.EXPANDED_CLASS).addClass(this.COLLAPSED_CLASS),r.gsap.to(e.find(".subnav"),this.ANIMATE_OPEN_DURATION,{height:"0","max-height":"0",ease:r.Cubic.Out}))},_openNav:function(e){Modernizr.csstransitions?e.removeClass(this.COLLAPSED_CLASS).addClass(this.EXPANDED_CLASS):(e.removeClass(this.COLLAPSED_CLASS).addClass(this.EXPANDED_CLASS),r.gsap.to(e.find(".subnav"),this.ANIMATE_CLOSED_DURATION,{height:"auto","max-height":"9999px",ease:r.Cubic.Out}))}});return a}),define("collections/PokedexCollection",["require","constants/Elements","underscore","backbone","models/BaseModel","collections/BaseCollection"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("models/BaseModel"),s=e("collections/BaseCollection"),o=s.extend({SIZES:{height:[["short","medium","tall"],t("body").hasClass("us")?[0,47,83]:[0,1.2,2.1]],weight:[["light","medium","heavy"],t("body").hasClass("us")?[0,99,499]:[0,45,226.3]]},model:i,urlBase:window.pokemonUI.api.pokedex,parse:function(e){var t=this;return n(e).each(function(e){var n=t._convertSize(e.height,"height"),r=t._convertSize(e.weight,"weight");e.height=n,e.weight=r}),e},initialize:function(e){this.options=e||{},this._super(),this.url=this.urlBase+"kalos"},applyFilters:function(e,t,r){var i=this;return t.length>0&&n(t).each(function(t){e=e.filter(function(e){var s=e.get(t.name);if(typeof s=="object")return n.find(s,function(e){return e=e.toLowerCase(),e===t.value.toLowerCase()});if(t.name==="name")return i._textSearch(e,t,r);if(t.length>0)return i._sizeFilter(e,t);if(t.value.length>0)return s>=t.value[0]&&s<=t.value[1]})}),e},shuffleItems:function(){return n.shuffle(this.models)},sortItems:function(e){e=e||"Select";var t=this.sortBy(function(t){return e.indexOf("name")>-1?t.get("slug").toLowerCase():t});return e.indexOf("Desc")>-1?t.reverse():t},_textSearch:function(e,t,n){var r=e.get(t.name);if(r===undefined||t.value===undefined)return null;if(this._isNumber(t.value))return r=e.get("number"),r.indexOf(parseFloat(t.value))>-1;var i=t.value.normalize("NFD").replace(/[\u0300-\u036f]/g,"");i=i.replace(/[.,\/#!$%\^&\*;:{}=\-_`’'~()]/g,""),i=i.replace(/\s/g,"");var s=new RegExp(i,"i"),o=r.toLowerCase().indexOf(t.value.toLowerCase())>-1;for(var u in n)s.test(u)&&(o+=r.toLowerCase().indexOf(n[u].toLowerCase())>-1);return o},_sizeFilter:function(e,t){var r=e.get(t[0].name),i=t[0].name,s=0;return n(t).each(function(e){s+=e.value===r}),s},_convertSize:function(e,t){var r=-1;return n(this.SIZES[t][1]).each(function(t){r+=e>t}),this.SIZES[t][0][r]},_isNumber:function(e){return!isNaN(parseFloat(e))}});return o}),define("templates/helpers/toLowerCase",["require","handlebars"],function(e){var t=typeof window=="undefined"?global:window,n=t.Handlebars||e("handlebars");n.registerHelper("toLowerCase",function(e){return e&&typeof e=="string"?e.toLowerCase():""})}),define("templates/pokedex/_attributes",["handlebars","templates/helpers/each","templates/helpers/toLowerCase"],function(e){e.registerPartial("pokedex_attributes",e.template({1:function(e,t,n,r){var i,s=t.helperMissing,o=this.lambda,u=this.escapeExpression,a='	<div class="abilities">\n		<span class="pill background-color-';return i=(t.toLowerCase||e&&e.toLowerCase||s).call(e,e,{name:"toLowerCase",hash:{},data:r}),i!=null&&(a+=i),a+'">'+u(o(e,e))+"</span>\n	</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s="\n";return i=t.each.call(e,e!=null?e.type:e,{name:"each",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),i!=null&&(s+=i),s},useData:!0}))}),define("templates/pokedex/pokedexItem",["handlebars","templates/pokedex/_attributes"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o="function",u=t.helperMissing,a=this.escapeExpression,f='\n<a href="'+a((s=(s=t.detailPageURL||(e!=null?e.detailPageURL:e))!=null?s:u,typeof s===o?s.call(e,{name:"detailPageURL",hash:{},data:r}):s))+'">\n	<img src="'+a((s=(s=t.ThumbnailImage||(e!=null?e.ThumbnailImage:e))!=null?s:u,typeof s===o?s.call(e,{name:"ThumbnailImage",hash:{},data:r}):s))+'" />\n</a>\n\n<div class="pokemon-info">\n	<p class="id">\n		<span class="number-prefix">#</span>'+a((s=(s=t.number||(e!=null?e.number:e))!=null?s:u,typeof s===o?s.call(e,{name:"number",hash:{},data:r}):s))+"\n	</p>\n	<h5>"+a((s=(s=t.name||(e!=null?e.name:e))!=null?s:u,typeof s===o?s.call(e,{name:"name",hash:{},data:r}):s))+"</h5>\n";return i=this.invokePartial(n.pokedex_attributes,"	","pokedex_attributes",e,undefined,t,n,r),i!=null&&(f+=i),f+"</div>\n"},usePartial:!0,useData:!0})}),define("views/pokedex/PokedexItemView",["require","constants/Elements","underscore","backbone","views/BaseView","detection/mobileDevice","detection/nintendoDevice","templates/pokedex/pokedexItem","animation/shuffle","animation/bounce"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("views/BaseView"),s=e("detection/mobileDevice"),o=e("detection/nintendoDevice"),u=e("templates/pokedex/pokedexItem"),a=e("animation/shuffle"),f=e("animation/bounce"),l=i.extend({el:".pokedex-results > ul",template:u,initialize:function(e){e=e||{},n.bindAll(this,"render")},render:function(){this.$listItem=t("<li />"),this.className&&this.$listItem.addClass(this.className);var e={addToCollection:window.pokemonUI.collectibles.toggles.addToCollection,addToWishlist:window.pokemonUI.collectibles.toggles.addToWishlist,addToTradelist:window.pokemonUI.collectibles.toggles.addToTradelist},n=t.extend(!0,e,this.model.toJSON()),r=this.template(n);this.$listItem.append(r),this.$el.append(this.$listItem),!s&&!o&&this._animateTile()},_animateTile:function(){a(this.$listItem,{pageSize:this.model.collection.options.pageSize,delay:.025})}});return l}),define("utils/PokedexTypeaheadSource",["require"],function(e){return function(e){return function(t,n){t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),t=t.replace(/[.,\/#!$%\^&\*;:{}=\-_`’'~()]/g,""),t=t.replace(/\s/g,"");var r=[],i=new RegExp(t,"i");for(var s=0;s<e.length;++s)if(i.test(e[s]))r.push(e[s]);else{var o=e[s].normalize("NFD").replace(/[\u0300-\u036f]/g,"");o=o.replace(/[.,\/#!$%\^&\*;:{}=\-_`’'~()]/g,""),o=o.replace(/\s/g,""),i.test(o)&&r.push(e[s])}n(r)}}}),define("models/SimpleFiltersModel",["require","backbone","models/BaseModel"],function(e){var t=e("backbone"),n=e("models/BaseModel"),r=n.extend({defaults:{type:{value:"All",className:""},weakness:{value:"All",className:""},abilities:{value:"All",className:""},height:{value:"All",className:""},weight:{value:"All",className:""},number:{value:"All",className:""}}});return r}),define("controllers/LocalisationController",["require","jquery"],function(e){var t=e("jquery"),n={FILTER_LABEL_CLASS:"filter",NUM_PREFIX_CLASS:"number-prefix",TYPE_CLASS:"background-color-",initialize:function(e){e=e||{};var n=e.container||t("body");window.pokemonUI.dictionary.type&&(this._localiseType(n),this._localiseSimpleFilters(n)),window.pokemonUI.dictionary.filters&&this._localiseFilters(n),window.pokemonUI.dictionary.numberPrefix&&this._localiseNumberPrefix(n)},_localiseFilters:function(e){var n=e.find("."+this.FILTER_LABEL_CLASS);for(var r=0,i=n.length;r<i;r++){var s=t(n[r]),o=t.trim(s.text().toLowerCase().replace(/[: ]/g,"")),u=window.pokemonUI.dictionary.filters[o];u!==undefined&&s.text(u+":")}},_localiseSimpleFilters:function(e){var n=window.pokemonUI.dictionary,r=e.find(".value");n=_.extend({},n.type,n.height,n.weight,n.abilities);for(var i=0,s=r.length;i<s;i++){var o=t(r[i]),u=t.trim(o.text()),a=n[u];a!==undefined&&o.text(a)}},_localiseNumberPrefix:function(e){var n=e.find("."+this.NUM_PREFIX_CLASS);for(var r=0,i=n.length;r<i;r++)t(n[r]).html(window.pokemonUI.dictionary.numberPrefix)},_localiseType:function(e){var n=e.find('*[class*="background-color-"]');for(var r=0,i=n.length;r<i;r++){var s=t(n[r]),o=t.trim(s.text()),u=o.toLowerCase(),a=window.pokemonUI.dictionary.type[u];a!==undefined&&s.html(s.html().replace(o,a))}}};return n}),define("templates/pokedex/pokedexSimpleFilters",["handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s=this.lambda,o=this.escapeExpression;return'\n\n	<li id="type" class="'+o(s((i=e!=null?e.type:e)!=null?i.className:i,e))+'">\n		<span class="filter">Type:</span>\n		<span class="value">'+o(s((i=e!=null?e.type:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n\n	<li id="weakness" class="'+o(s((i=e!=null?e.weakness:e)!=null?i.className:i,e))+'">\n		<span class="filter">Weakness:</span>\n		<span class="value">'+o(s((i=e!=null?e.weakness:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n\n	<li id="ability" class="'+o(s((i=e!=null?e.abilities:e)!=null?i.className:i,e))+'">\n		<span class="filter">Ability:</span>\n		<span class="value">'+o(s((i=e!=null?e.abilities:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n\n	<li id="height" class="'+o(s((i=e!=null?e.height:e)!=null?i.className:i,e))+'">\n		<span class="filter">Height:</span>\n		<span class="value">'+o(s((i=e!=null?e.height:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n\n	<li id="weight" class="'+o(s((i=e!=null?e.weight:e)!=null?i.className:i,e))+'">\n		<span class="filter">Weight:</span>\n		<span class="value">'+o(s((i=e!=null?e.weight:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n\n	<li id="number" class="'+o(s((i=e!=null?e.number:e)!=null?i.className:i,e))+'">\n		<span class="filter">Num Range:</span>\n		<span class="value">'+o(s((i=e!=null?e.number:e)!=null?i.value:i,e))+'</span>\n		<span class="icon icon_multiply removeFilter"></span>\n	</li>\n'},useData:!0})}),define("views/pokedex/PokedexSimpleFiltersView",["require","constants/Elements","underscore","backbone","views/BaseView","controllers/LocalisationController","templates/pokedex/pokedexSimpleFilters"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("views/BaseView"),s=e("controllers/LocalisationController"),o=e("templates/pokedex/pokedexSimpleFilters"),u=i.extend({ACTIVE_CLASS:"active-simple-filter",DEFAULT_VALUE:"All",el:".simple-filters",template:o,events:{"click .removeFilter":"_onRemoveFilterClick"},initialize:function(e){e=e||{},n.bindAll(this,"render","_updateSimpleFilters","_setSimpleFilters","_combineFilterObjects","_onRemoveFilterClick"),this.model.on("change",this.render),this.render()},render:function(){this.$el.empty(),this.$el.append(this.template(this.model.toJSON())),s.initialize({container:this.$el})},_updateSimpleFilters:function(e){var t=this;this._filterArray=e._filterArray,this._allFilters=this._combineFilterObjects();var r=n(this._allFilters).pluck("name"),i=this.model.toJSON();for(var s in i)this._setSimpleFilters(s,r)},_setSimpleFilters:function(e,t){var r=this,i=n(t).filter(function(t){return t===e}),s=n(this._allFilters).filter(function(t){return t.name===e}),o={value:this.DEFAULT_VALUE,className:""};if(i.length===1){var u=s[0].value;u=e==="number"?u.join("-"):u,o.value=u,o.className=this.ACTIVE_CLASS}else i.length>1&&(o.value=i.length+" Selected",o.className=this.ACTIVE_CLASS);this.model.set(e,o)},_combineFilterObjects:function(){var e=[],t=n(this._filterArray).filter(function(e){return e.length>0}),r=n(this._filterArray).reject(function(e){return e.length>0});n(t).each(function(t){n(t).each(function(t){e.push(t)})});var i=e.concat(r);return i},_onRemoveFilterClick:function(e){e.preventDefault();var n=t(e.currentTarget);t.publish("resetFilterGroup",n)}});return u}),define("views/pokedex/PokedexFilterView",["require","constants/Elements","underscore","backbone","typeahead","utils/PokedexTypeaheadSource","views/BaseView","models/SimpleFiltersModel","views/pokedex/PokedexSimpleFiltersView","templates/pokedex/pokedexSimpleFilters","events/TrackingEvent","utils/parseQueryString"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("typeahead"),s=e("utils/PokedexTypeaheadSource"),o=e("views/BaseView"),u=e("models/SimpleFiltersModel"),a=e("views/pokedex/PokedexSimpleFiltersView"),f=e("templates/pokedex/pokedexSimpleFilters"),l=e("events/TrackingEvent"),c=e("utils/parseQueryString"),h=o.extend({RANGE_MIN:0,RANGE_MAX:1,DEFAULT_SEARCH:"",SELECTED_CLASS:"active-filter",HIGHLIGHT_CLASS:"highlight",DEFAULT_ABILITY:"All",el:".pokedex-filter",events:function(){return{"click #search":"_onSearchButtonClick","keyup #search":"_onSearchButtonEntered","click #advSearch":"_onSearchButtonClick","keyup #advSearch":"_onSearchButtonEntered","click #reset":"_onResetButtonClick","keyup #reset":"_onResetButtonEntered","click .toggle":"_onFilterButtonClick","keyup .toggle":"_onFilterButtonEntered","click .size":"_onSizeButtonClick","keyup .size":"_onSizeButtonEntered","change #abilities":"_onAbilitiesChange","focus .range-box":"_onRangeBoxFocus","keyup #searchInput":"_onSearchInputChange"}},ui:{rangeSlider:".rangeSlider",rangeMin:"#min",rangeMax:"#max",range:"#range-boxes",minRangeBox:"#minRangeBox",maxRangeBox:"#maxRangeBox",abilities:"#abilities",filters:".pokedex-filter-wrapper",searchInput:"#searchInput"},_filterArray:[],initialize:function(e){e=e||{},n.bindAll(this,"_createSubViews","_initAutoComplete","_resetRangeBoxes","_resetAllFilters","_resetFilterGroup","_resetAbilityFilter","_resetSearchInput","_checkQueryString","_setFilters","_sizeFilter","_updateSimpleFilters","_gatherSelectedFilters","_addEventHandlers","_onSearchButtonClick","_onSearchButtonEntered","_onSearchButtonClick","_onSearchButtonEntered","_blurSearchInput","_onResetButtonClick","_onResetButtonEntered","_onFilterButtonClick","_onFilterButtonEntered","_onSizeButtonClick","_onSizeButtonEntered","_onAbilitiesChange","_onRangeBoxFocus","_onSearchInputChange","_dataLayerPokedexSearch"),this.bindUIElements();var r=this;this.render(),this._createSubViews(),t("#abilitiesSelect").attr("tabIndex",-1),this.RANGE_MIN=parseInt(this.ui.rangeMin.text(),10),this.RANGE_MAX=parseInt(this.ui.rangeMax.text(),10),this._addEventHandlers(),t.subscribe("collectionFetch",function(){r._initAutoComplete()}),this._checkQueryString()},_createSubViews:function(){this.simpleFiltersModel=new u,this.simpleFiltersView=new a({model:this.simpleFiltersModel})},_initAutoComplete:function(){this.ui.searchInput.typeahead({},{source:new s(n(this.collection.toJSON()).pluck("name"))})},_resetRangeBoxes:function(){this.ui.minRangeBox.val(this.RANGE_MIN),this.ui.maxRangeBox.val(this.RANGE_MAX),this.ui.range.removeClass(this.SELECTED_CLASS)},_resetAllFilters:function(){t("."+this.SELECTED_CLASS).removeClass(this.SELECTED_CLASS),t("."+this.HIGHLIGHT_CLASS).removeClass(this.HIGHLIGHT_CLASS),this._resetAbilityFilter(),this._resetRangeBoxes(),this._resetSearchInput()},_resetFilterGroup:function(e,n){var r=t(n),i=r.parent().attr("id"),s=t("."+i);i==="ability"?this._resetAbilityFilter():i==="number"?this._resetRangeBoxes():(i==="height"||i==="weight")&&s.find("."+this.HIGHLIGHT_CLASS).removeClass(this.HIGHLIGHT_CLASS),s.removeClass(this.SELECTED_CLASS),t.publish("filterChange")},_resetAbilityFilter:function(){this.ui.abilities.val(this.DEFAULT_ABILITY),this.ui.abilities.trigger("reset")},_resetSearchInput:function(){this.ui.searchInput.val(this.DEFAULT_SEARCH),this.ui.searchInput.typeahead("val",this.DEFAULT_SEARCH),this.ui.searchInput.removeClass(this.SELECTED_CLASS)},_checkQueryString:function(){var e=["type","weakness","number","abilities","height","weight"],t=c(window.location.search.substr(1)),n=[];if(t){for(var r in t){var i=t[r];typeof i=="string"&&(i=[i]);if(e.indexOf(r)!==-1)for(var s=0;s<i.length;s++)r==="number"&&(i[s]=i[s].split("-"),i[s][0]=parseInt(i[s][0],10),i[s][1]=parseInt(i[s][1],10)),n.push({name:r,value:i[s]})}n&&this._setFilters(n)}},_setFilters:function(e){for(var n=0;n<e.length;n++){var r=e[n].name,i=e[n].value,s,o;r==="type"||r==="weakness"?(s=t(".toggle[data-type="+r+"][data-value="+i+"]"),this._onFilterButtonClick({currentTarget:s.get(0)})):r==="weight"||r==="height"?(s=t(".size[data-type="+r+"][data-value="+i+"]"),this._onSizeButtonClick({currentTarget:s.get(0)})):r==="abilities"?(this.ui.abilities.val(i),t('li[data-option-value="'+i+'"]',".abilities-filter").trigger("mousedown"),this._onAbilitiesChange({currentTarget:this.ui.abilities})):r==="number"&&(this.ui.minRangeBox.val(i[0]),this.ui.maxRangeBox.val(i[1]),this._onRangeBoxFocus())}},_sizeFilter:function(e){var n=[],r=e.find("."+this.HIGHLIGHT_CLASS);return r.each(function(e,r){var i=t(r),s=i.data("type"),o=i.data("value"),u={name:s,value:o};n.push(u)}),n},_updateSimpleFilters:function(){this._gatherSelectedFilters(),this.simpleFiltersView._updateSimpleFilters(this)},_gatherSelectedFilters:function(){var e=this,n,r,i;this._filterArray=[],this._filterArrayString="",t("."+this.SELECTED_CLASS).each(function(s,o){var u=t(o);n=u.data("type"),r=u.data("value"),r=r?r:u.val(),r=r?r:[parseInt(u.children("#minRangeBox").val()),parseInt(u.children("#maxRangeBox").val())],n==="weight"||n==="height"?(i=e._sizeFilter(u),e._filterArrayString+=', "'+n+'":"'+i[0].value+'"'):(n==="weakness"&&window.pokemonUI.dictionary.type&&(r=window.pokemonUI.dictionary.type[r]),i={name:n,value:r},e._filterArrayString+='"'+n+'":"'+r+'",'),e._filterArray.push(i)}),this._filterArrayString.length&&(window.PokedexSearch=window.PokedexSearch||{},t.publish(l.TRACK,["1.10.1",{label:this._filterArrayString}]))},_addEventHandlers:function(){t.subscribe("resetFilterGroup",this._resetFilterGroup),t.subscribe("filterChange",this._blurSearchInput)},_onSearchButtonClick:function(e){e.preventDefault(),this._dataLayerPokedexSearch(e),t.publish("filterChange")},_onSearchButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_blurSearchInput:function(){this.ui.searchInput.blur()},_onResetButtonClick:function(e){e.preventDefault(),this._resetAllFilters(),this._updateSimpleFilters()},_onResetButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_onFilterButtonClick:function(e){t(e.currentTarget).toggleClass(this.SELECTED_CLASS)},_onFilterButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_onSizeButtonClick:function(e){var n=t(e.currentTarget);n.toggleClass(this.HIGHLIGHT_CLASS),n.parent().find("."+this.HIGHLIGHT_CLASS).length>0?n.parent().addClass(this.SELECTED_CLASS):n.parent().removeClass(this.SELECTED_CLASS)},_onSizeButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_onAbilitiesChange:function(e){var n=t(e.currentTarget);n.val()!==this.DEFAULT_ABILITY?n.addClass(this.SELECTED_CLASS):n.removeClass(this.SELECTED_CLASS)},_onRangeBoxFocus:function(e){this.ui.range.addClass(this.SELECTED_CLASS)},_onSearchInputChange:function(e){var n=t(e.currentTarget);n.val().length>0?n.addClass(this.SELECTED_CLASS):n.removeClass(this.SELECTED_CLASS),e.keyCode===13&&(this._dataLayerPokedexSearch(e),t.publish("filterChange"))},_dataLayerPokedexSearch:function(e){window.PokedexSearch={};var t=e?e.currentTarget.className:null,n=window.PokedexSearch,r=e?e.currentTarget.localName:null,i=e?e.currentTarget.id:null;r=="a"&&i=="search"?n.PokedexSearchType="Advanced":n.PokedexSearchType="Basic",n.Keyword=this.ui.searchInput.val()}});return h}),define("views/pokedex/PokedexView",["require","constants/Elements","underscore","backbone","gsapJS","nouislider","detection/mobileDevice","detection/nintendoDevice","events/ScrollEvent","views/BaseView","views/pokedex/PokedexItemView","views/pokedex/PokedexFilterView","animation/bounce","ScrollTo","utils/parseQueryString","controllers/LocalisationController","events/TrackingEvent","events/UserEvent","models/userModel"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("gsapJS"),s=e("nouislider"),o=e("detection/mobileDevice"),u=e("detection/nintendoDevice"),a=e("events/ScrollEvent"),f=e("views/BaseView"),l=e("views/pokedex/PokedexItemView"),c=e("views/pokedex/PokedexFilterView"),h=e("animation/bounce"),p=e("ScrollTo"),d=e("utils/parseQueryString"),v=window.pokemonUI.dictionary.type,m=e("controllers/LocalisationController"),g=e("events/TrackingEvent"),y=e("events/UserEvent"),b=e("models/userModel");i.gsap.registerPlugin(p);var w=f.extend({ARROWUP_CLASS:"icon_arrow_sm_up",ARROWDOWN_CLASS:"icon_arrow_sm_down",DISABLED_CLASS:"disabled",OPEN_CLASS:"open",SCROLL_OFFSET:50,loadingClass:"loading",_allowScrolling:!1,_scrollTo:!1,el:".pokedex",events:function(){return{"click #loadMore":"_onLoadButtonClick","keyup #loadMore > span":"_onLoadButtonEntered","click #shuffle":"_onShuffleButtonClick","keyup #shuffle":"_onShuffleButtonEntered","click .filter-toggle-span":"_onFiltersToggleDrawerClick","keyup .filter-toggle-span":"_onFiltersToggleDrawerEntered","mouseenter .results > li":"_onTileHover"}},ui:{loadMoreBtn:"#loadMore",loadMoreSpan:"#loadMore > span",shuffleBtn:"#shuffle",resultsContainer:".pokedex-results",resultsList:".results",resultsListItem:".results > li",sortOrder:"#sortOrder",filters:".pokedex-filter-wrapper",simpleFilters:".simple-filters-wrapper",toggleText:".filter-toggle-span .text",arrowIcon:".filter-toggle-span .icon",noResults:".no-results",promos:".pokedex-promo",loader:".loader"},_pokemonViewArray:[],_filterArray:[],_index:0,_queryStringParams:{},_isLoading:!0,_keyboardFocus:!1,_prevArraySize:0,_previousSortValue:"noSort",_isCollectionFetched:!1,initialize:function(e){var r=this;e=e||{},this._queryStringParams=d(window.location.search.substr(1)),n.bindAll(this,"render","_getItemsToLoad","_createSubViews","_handleErrorViewDisplay","_resetList","_sortOrderUpdate","_filterResults","_scrollToResults","_closeFilterDrawer","_openFilterDrawer","_showFilterDrawerElements","_hideFilterDrawerElements","_addLoadingIndicator","_removeLoadingIndicator","_addEventHandlers","_onUserDetailsLoaded","_updateCollectionCounts","_setActiveCollectionTab","_onPokedexVersionChange","_onFiltersToggleDrawerClick","_onFiltersToggleDrawerEntered","_onLoadButtonClick","_onShuffleButtonClick","_onShuffleButtonEntered","_onScrollChange","_onTileHover","_selectCollection","_updateCollectionDict"),this.bindUIElements(),this._addEventHandlers(),this._createSubViews(),r.ui.loadMoreBtn.attr("tabIndex",-1),r.ui.loadMoreSpan.attr("tabIndex",0),this.filteredCollection=this.collection.models,this._prevArraySize=this.collection.options.pageSize,this.collection.fetch({success:function(){r._isCollectionFetched=!0,r.namesCollectionDict=r._updateCollectionDict(n(r.collection.toJSON()).pluck("name")),r._filterResults(),t.publish("collectionFetch"),r.ui.shuffleBtn.removeClass(r.DISABLED_CLASS),r.ui.loadMoreBtn.removeClass(r.DISABLED_CLASS);var e=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.replaceState({},document.title,e)},error:function(){r._isLoading=!0,r._removeLoadingIndicator(),r._handleErrorViewDisplay()}})},render:function(){for(var e=this._index;e<this.itemsToLoad+this._index;e++)this._pokemonViewArray[e]&&this._pokemonViewArray[e].render();this._index=e,this._isLoading=!1,this._removeLoadingIndicator(),this._handleErrorViewDisplay(),m.initialize({container:this.$el.find(".pokedex-results")});if(this._keyboardFocus){var n=this._prevArraySize;t(this.ui.resultsList[0]).find("li").eq(n).find("a").focus(),this._keyboardFocus=!1}return this._prevArraySize=this._pokemonViewArray.length,t.publish("togglesReady"),this.$el},_getItemsToLoad:function(e,r,i){var s=this;r||this._resetList(),this.itemsToLoad=i?i:this.collection.options.pageSize,this._pageItemCounter=0,this.promises=[],this._index=Math.min(this._index,this._pokemonViewArray.length);for(var o=this._index;o<this.itemsToLoad+this._index;o++)if(e[o]){this._pokemonViewArray.push(new l({model:e[o]})),this.promises[o]=t.Deferred();var u=new Image;u.onload=this.promises[o].resolve,u.onerror=this.promises[o].resolve;var a=this._pokemonViewArray[o].model.get("ThumbnailImage");window.mockAPI&&(a=a.replace("/static2/_ui/","http://assets.pokemon.com/assets/cms2/")),u.src=a,this._pageItemCounter++}this._pokemonViewArray=n.uniq(this._pokemonViewArray,!1,function(e){return e.model.cid}),this.promises.length>0?t.when.apply(t,this.promises).then(function(){s.render()}):(this._isLoading=!1,this._removeLoadingIndicator(),this._handleErrorViewDisplay()),this._allowScrolling?this._scrollToResults():this._allowScrolling=!0},_createSubViews:function(){this.filterView=new c({collection:this.collection})},_handleErrorViewDisplay:function(){this._pokemonViewArray.length===0&&(this.ui.noResults.fadeIn(),this.ui.loadMoreBtn.fadeOut(400,function(){t(this).hide()}))},_resetList:function(){var e=this;this.ui.noResults.fadeOut(),this._index=0;var t=this.ui.resultsList.height();t>0&&this.ui.resultsList.css({height:t}),this.ui.resultsList.empty(),setTimeout(function(){e.ui.resultsList.css({height:"auto"})},100),this._pokemonViewArray=[]},_sortOrderUpdate:function(){var e=this,n=this.ui.sortOrder.val();n!=="noSort"&&n!==e._previousSortValue&&(e._allowScrolling=!1,e._filterResults(),e._previousSortValue=n,window.PokedexSearch=window.PokedexSearch||{},window.PokedexSearch.PokedexSearchSortBy=n,t.publish(g.TRACK,["1.10.3",{label:n}]))},_filterResults:function(){this._scrollTo=!0,this._addLoadingIndicator();var e=this.ui.sortOrder.val();this.filterView._updateSimpleFilters(),this.sortedModels=this.collection.sortItems(e),this.filteredCollection=this.collection.applyFilters(this.sortedModels,this.filterView._filterArray,this.namesCollectionDict),t(".all-pokemon span.total").text("("+this.filteredCollection.length+")"),this.filteredSlugs=n.map(this.filteredCollection,function(e){return e.get("collectibles_slug")}),t(this.ui.loadMoreBtn).css({display:this.filteredCollection.length<=1?"none":"inline-block"}),window.PokedexSearch=window.PokedexSearch||{},this.filteredCollection.length<=1?window.PokedexSearch.searchResults="":window.PokedexSearch.searchResults=this.filteredCollection.length,this._getItemsToLoad(this.filteredCollection),this._updateCollectionCounts()},_scrollToResults:function(){if(this._allowScrolling&&this._scrollTo){this._scrollTo=!1;var e=this.ui.resultsContainer.offset().top-this.SCROLL_OFFSET;t("body, html").animate({scrollTop:e},1e3)}},_closeFilterDrawer:function(){var e=this;this.ui.filters.css({height:this.ui.filters.height()}),i.gsap.to(this.ui.filters,.3,{height:0,ease:i.Expo.easeInOut}),this.ui.filters.removeClass(this.OPEN_CLASS),this.ui.arrowIcon.removeClass(this.ARROWUP_CLASS).addClass(this.ARROWDOWN_CLASS),this.ui.toggleText.text(window.pokemonUI.dictionary.show),i.gsap.to(this.ui.simpleFilters,.3,{height:this.simpleFilterHeight,ease:i.Expo.easeInOut,onComplete:function(){e.ui.simpleFilters.css({height:"inherit"})}}),this._allowScrolling=!1,this._hideFilterDrawerElements(),this._filterResults()},_openFilterDrawer:function(){var e=this,n=t(".pokedex-filter-wrapper__inner").height();i.gsap.to(this.ui.filters,.3,{height:n,ease:i.Expo.easeInOut,onComplete:function(){e.ui.filters.css({height:"inherit"})}}),this.ui.filters.addClass(this.OPEN_CLASS),this.ui.arrowIcon.removeClass(this.ARROWDOWN_CLASS).addClass(this.ARROWUP_CLASS),this.ui.toggleText.text(window.pokemonUI.dictionary.hide),this.simpleFilterHeight=this.ui.simpleFilters.height(),i.gsap.to(this.ui.simpleFilters,.3,{height:0,ease:i.Expo.easeInOut}),this._showFilterDrawerElements()},_showFilterDrawerElements:function(){t("#abilitiesSelect").attr("tabIndex",0),t("#advSearch").attr("tabIndex",0),t("#minRangeBox").attr("tabIndex",0),t("#maxRangeBox").attr("tabIndex",0),t("#reset").attr("tabIndex",0),t(".size").attr("tabIndex",0),t(".toggle").attr("tabIndex",0)},_hideFilterDrawerElements:function(){t("#abilitiesSelect").attr("tabIndex",-1),t("#advSearch").attr("tabIndex",-1),t("#minRangeBox").attr("tabIndex",-1),t("#maxRangeBox").attr("tabIndex",-1),t("#reset").attr("tabIndex",-1),t(".size").attr("tabIndex",-1),t(".toggle").attr("tabIndex",-1)},_addLoadingIndicator:function(e){var n=this;this.isLoading?this._removeLoadingIndicator():this.isLoading=!0,this.ui.loader||(this.ui.loader=t('<div class="loader" />')),this.ui.loader.addClass(e).css({opacity:1,display:"block"}),this.ui.loader.appendTo(this.ui.resultsContainer),this.ui.resultsContainer.addClass(this.loadingClass)},_removeLoadingIndicator:function(){this.ui.loader.remove(),this.ui.resultsContainer.removeClass(this.loadingClass)},_addEventHandlers:function(){t.subscribe("filterChange",this._filterResults),t.subscribe(y.USER_DETAILS_LOADED,n.bind(this._onUserDetailsLoaded,this)),t.subscribe(y.TOGGLE_COLLECTIBLE,n.bind(this._updateCollectionCounts,this)),t("#sortOrder").on("change",this._sortOrderUpdate),t("#pokedex-version").on("change",this._onPokedexVersionChange),t(".nav--tab-switcher__item a").on("click",this._selectCollection),document.onselectstart=function(){return!1}},_onUserDetailsLoaded:function(e){b.get("isAuthenticated")?(this._updateCollectionCounts(),this._queryStringParams.tab&&this._setActiveCollectionTab(this._queryStringParams.tab),t(".pokedex-tabs div").removeClass("hidden")):t(".login-cta").removeClass("hidden")},_updateCollectionCounts:function(){if(!b.get("isAuthenticated"))return;t(".nav--tab-switcher__item a").each(n.bind(function(e,r){if(!t(r).data("collection"))return;var i=b.get("collectibles").pokemon[t(r).data("collection")],s=n.intersection(i,this.filteredSlugs).length;t("span.total",r).text("("+s+")")},this))},_setActiveCollectionTab:function(e){this._isCollectionFetched?t(".nav--tab-switcher__item a[data-collection='"+e+"']").trigger("click"):(t(".nav--tab-switcher__item a").removeClass("active"),t(".nav--tab-switcher__item a[data-collection='"+e+"']").addClass("active"))},_onPokedexVersionChange:function(e){var n=this,r=t(e.currentTarget);this.filterView._resetAllFilters(),this._addLoadingIndicator(),this.collection.url=this.collection.urlBase+r.val(),this.collection.fetch({success:function(e){n._getItemsToLoad(e.models)}})},_onFiltersToggleDrawerClick:function(e){this.ui.filters.hasClass(this.OPEN_CLASS)?this._closeFilterDrawer():this._openFilterDrawer()},_onFiltersToggleDrawerEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_onLoadButtonClick:function(e){e.preventDefault(),e.stopPropagation();if(this.ui.loadMoreBtn.hasClass(this.DISABLED_CLASS))return!1;this._scrollTo=!1,this._getItemsToLoad(this.filteredCollection,!0);var n=this.collection.options.pageSize;this.filteredCollection.length<=this._index+n&&this.ui.loadMoreBtn.fadeOut(400,function(){t(this).hide()}),this.ui.promos.slideUp(),t.publish(g.TRACK,["1.10.4",{label:""}])},_onLoadButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&(t(e.currentTarget).click(),this._keyboardFocus=!0)},_onShuffleButtonClick:function(e){e.preventDefault(),e.stopPropagation();if(this.ui.shuffleBtn.hasClass(this.DISABLED_CLASS))return!1;this._addLoadingIndicator(),this.filterView._resetAllFilters(),this.ui.sortOrder.trigger("reset"),t.publish(g.TRACK,["1.10.2",{}]),this.shuffledModels=this.collection.shuffleItems(),this.filterView._updateSimpleFilters(),this.filteredCollection=this.collection.applyFilters(this.shuffledModels,this.filterView._filterArray,this.namesCollectionDict),t(this.ui.loadMoreBtn).css({display:this.filteredCollection.length<=1?"none":"inline-block"}),this._getItemsToLoad(this.filteredCollection),window.PokedexSearch=window.PokedexSearch||{},window.PokedexSearch.PokedexSurpriseMe="true"},_onShuffleButtonEntered:function(e){e.preventDefault(),e.keyCode===13&&t(e.currentTarget).click()},_onScrollChange:function(e,n){var r=this,i=n+t.window.height(),s=this.$el.offset().top+this.$el.height();i>s&&(this._isLoading||(this._isLoading=!0,this._addLoadingIndicator("bottom"),this._getItemsToLoad(this.filteredCollection,!0)))},_onTileHover:function(e){h(t(e.currentTarget))},_selectCollection:function(e){e.preventDefault(),t(".nav--tab-switcher__item a").removeClass("active"),t(e.currentTarget).addClass("active"),t.publish("filterChange")},_updateCollectionDict:function(e){var t={};for(var n=0;n<e.length;++n){var r=e[n].normalize("NFD").replace(/[\u0300-\u036f]/g,"");r=r.replace(/[.,\/#!$%\^&\*;:{}=\-_`’'~()]/g,""),r=r.replace(/\s/g,""),t[r]=e[n]}return t}});return w}),define("views/collectibles/TogglesView",["require","constants/Elements","underscore","views/BaseView","models/userModel","events/UserEvent","views/ModalBaseView"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("views/BaseView"),i=e("models/userModel"),s=e("events/UserEvent"),o=e("views/ModalBaseView"),u=r.extend({el:".collectibles-results",toggleInProcess:!1,initialize:function(e){this._super(e),this.collectibleKind=e.collectibleKind||"pokemon";var r=this;t.subscribe(s.REMOVE_FROM_FAVORITES,n.bind(r._removeFavorite,this))},ui:{authRequired:"#pokedex-collectible-auth-error-modal"},_authRequired:function(e){this._modal.open()},_addFavoriteEvent:function(){t(".collectibles-wrapper .addToFavorites").on("click",function(e){e.preventDefault();var n=t(e.currentTarget);t(e.currentTarget).removeAttr("rel").trigger("mouseleave").off("click").removeAttr("href").removeClass("active").addClass("active").find("span").removeClass("icon_add icon_pokedex_added").addClass("icon_pokedex_added")})},_removeFavorite:function(e){t(".collectibles-wrapper .addToFavorites").removeClass("active").find("span").removeClass("icon_add icon_pokedex_added").addClass("icon_add"),this._addFavoriteEvent()},_toggleCollectible:function(e){var n=this;e.preventDefault();if(this.toggleInProcess)return;if(t(e.currentTarget).hasClass("addToFavorites")){t.publish(s.ADD_TO_FAVORITES,t(e.currentTarget).data("pokemon-id"));return}this.toggleInProcess=!0;var r=t(e.currentTarget).data("collection"),o=t(e.currentTarget).closest(".collectibles-wrapper").data("collectibles-slug"),u="https://"+location.hostname+"/api/users/"+(i.get("id")||0)+"/collections/"+r+"/collectibles/"+o+"/kind/"+this.collectibleKind,a=t(e.currentTarget).hasClass("active")?"DELETE":"POST";t.ajax({type:a,url:u,dataType:"json",context:{el:e.currentTarget,slug:o,collection:r,kind:this.collectibleKind,action:a==="POST"?"adding":"deleting",modal:this._modal,self:this}}).done(function(e,n,o){i.updateSeriesData(function(){t.publish(s.SERIES_UPDATE)}),this.action==="adding"?(t(this.el).removeClass("active").addClass("active"),t(this.el).data("collection")==="have"&&t(this.el).closest("li.animating").removeClass("active").addClass("active"),i.addCollectible(this.slug,this.collection,this.kind)):(t(this.el).removeClass("active"),t(this.el).data("collection")==="have"&&t(this.el).closest("li.animating").removeClass("active"),i.removeCollectible(this.slug,this.collection,this.kind));var u=e?e.restrictions:undefined,a=this.action==="adding";if(u){var f=t(this.el).closest(".collectibles-wrapper");for(var l in u.add)r=u.add[l],t("a[data-collection="+r+"]",f).removeClass("active").addClass("active"),i.addCollectible(this.slug,r,this.kind);for(l in u.remove)r=u.remove[l],t("a[data-collection="+r+"]",f).removeClass("active"),i.removeCollectible(this.slug,r,this.kind)}t.publish(s.TOGGLE_COLLECTIBLE,[this.slug,this.collection,this.kind,a,u])}).fail(function(e,t,n){e.status===401&&this.modal.open()}).always(function(){this.self.toggleInProcess=!1})}});return u}),define("modules/Pokedex",["require","jquery","underscore","modules/BaseModule","views/PageNavigationView","collections/PokedexCollection","views/pokedex/PokedexView","views/collectibles/TogglesView"],function(e){var t=e("jquery"),n=e("underscore"),r=e("modules/BaseModule"),i=e("views/PageNavigationView"),s=e("collections/PokedexCollection"),o=e("views/pokedex/PokedexView"),u=e("views/collectibles/TogglesView"),a=n.extend(r,{PAGE_SIZE:12,_initModule:function(){t(".container").addClass("pokedex"),this._addViews()},_addViews:function(){var e=new i({el:".page-navigation"});this.pokedexCollection=new s({pageSize:this.PAGE_SIZE});var t=new u({collectibleKind:"pokemon"}),n=new o({collection:this.pokedexCollection})}});return a});